<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Anúncio de Veículo</title>
    <!-- Incluindo Tailwind CSS para um design moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Adicionando a fonte moderna 'Inter' do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para a animação do switch do câmbio */
        .peer:checked ~ .peer-checked\:after\:translate-x-full::after {
            transform: translateX(100%);
        }
        .peer:checked ~ .peer-checked\:bg-red-600 {
            background-color: #DC2626; /* red-600 */
        }
        /* Estilização para o placeholder do input de arquivo */
        input[type="file"]::file-selector-button {
            @apply bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors duration-300;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-red-500">Gerador de Anúncio de Veículo</h1>
            <p class="text-gray-400 mt-2">Preencha os dados, anexe uma foto e crie sua imagem de venda na hora.</p>
        </header>

        <!-- Conteúdo principal: formulário e prévia -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coluna do Formulário -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl">
                <form id="vehicleForm" class="space-y-6">
                    <!-- Foto do Veículo -->
                    <div>
                        <label for="vehiclePhoto" class="block text-sm font-medium text-gray-300 mb-2">1. Foto do Veículo</label>
                        <input type="file" id="vehiclePhoto" accept="image/*" required class="block w-full text-sm text-gray-400 file:mr-4 file:border-0 rounded-lg">
                    </div>
                    
                    <hr class="border-gray-600">
                    <h2 class="text-lg font-semibold text-gray-200 !mt-4">2. Detalhes do Anúncio</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Marca -->
                        <div>
                            <label for="marca" class="block text-sm font-medium text-gray-300">Marca</label>
                            <input type="text" id="marca" placeholder="Ex: Hyundai" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                        <!-- Modelo -->
                        <div>
                            <label for="modelo" class="block text-sm font-medium text-gray-300">Modelo</label>
                            <input type="text" id="modelo" placeholder="Ex: HB20 Comfort" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ano do Veículo -->
                        <div>
                            <label for="ano" class="block text-sm font-medium text-gray-300">Ano</label>
                            <input type="text" id="ano" placeholder="Ex: 2022" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                        <!-- Kilometragem -->
                        <div>
                            <label for="km" class="block text-sm font-medium text-gray-300">Kilometragem</label>
                            <input type="text" id="km" placeholder="Ex: 50000" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                        </div>
                    </div>

                    <!-- Motor -->
                    <div>
                        <label for="cilindrada" class="block text-sm font-medium text-gray-300">Motor</label>
                        <input type="text" id="cilindrada" placeholder="Ex: 1.0" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>
                    
                    <!-- Câmbio -->
                    <div class="flex items-center justify-between">
                         <label for="cambio" class="block text-sm font-medium text-gray-300">Câmbio</label>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-medium text-gray-400">Manual</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="cambio" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                             <span class="text-sm font-medium text-gray-400">Automático</span>
                        </div>
                    </div>

                    <!-- Preço -->
                     <div>
                        <label for="preco" class="block text-sm font-medium text-gray-300">Preço</label>
                        <input type="text" id="preco" placeholder="Ex: 59900" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>

                    <hr class="border-gray-600">
                    <h2 class="text-lg font-semibold text-gray-200 !mt-4">3. Contato</h2>
                     <!-- Telefone -->
                    <div>
                        <label for="telefone" class="block text-sm font-medium text-gray-300">Telefone para WhatsApp</label>
                        <input type="tel" id="telefone" maxlength="15" placeholder="(00) 90000-0000" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 text-white">
                    </div>
                </form>
            </div>

            <!-- Coluna da Prévia -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl flex flex-col items-center justify-center min-h-[400px]">
                <div id="previewArea" class="w-full aspect-video bg-gray-700 rounded-md flex items-center justify-center text-gray-500 border-2 border-dashed border-gray-600">
                    <span class="text-center">A prévia da imagem aparecerá aqui<br>após carregar uma foto.</span>
                </div>
                <a id="downloadLink" href="#" download="anuncio-veiculo.jpg" class="hidden mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-lg">
                    Baixar Imagem Final
                </a>
            </div>
        </main>
    </div>

    <script>
        window.addEventListener('load', function() {
            // --- Referências aos elementos do DOM ---
            const form = document.getElementById('vehicleForm');
            const fileInput = document.getElementById('vehiclePhoto');
            const telefoneInput = document.getElementById('telefone');
            const precoInput = document.getElementById('preco');
            const kmInput = document.getElementById('km');
            const previewArea = document.getElementById('previewArea');
            const downloadLink = document.getElementById('downloadLink');

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.className = "rounded-md shadow-lg w-full h-auto";

            let uploadedImage = null;
            const adColor = '#ce191f';
            const fixedAddress = "Rua David Nasser, 339";
            
            // Carregando logos e ícones fixos
            const fixedLogo = new Image();
            fixedLogo.src = "https://apps.grupobhds.com/gerador-anuncio/images/logo.png";
            fixedLogo.crossOrigin = "Anonymous";

            const phoneIcon = new Image();
            phoneIcon.src = "https://apps.grupobhds.com/gerador-anuncio/images/logo-zap.png";
            phoneIcon.crossOrigin = "Anonymous";

            const mapsIcon = new Image();
            mapsIcon.src = "https://apps.grupobhds.com/gerador-anuncio/images/logo-maps.png";
            mapsIcon.crossOrigin = "Anonymous";

            // Redesenha a prévia quando os ícones carregam
            [fixedLogo, phoneIcon, mapsIcon].forEach(img => {
                img.onload = () => updatePreview();
            });


            // --- Local Storage Functions ---
            function saveData() {
                localStorage.setItem('savedTelefone', telefoneInput.value);
            }

            function loadSavedData() {
                telefoneInput.value = localStorage.getItem('savedTelefone') || '';
            }
            
            loadSavedData(); // Carrega os dados ao iniciar

            // --- Event Listeners ---
            fileInput.addEventListener('change', (e) => handleImageUpload(e));
            form.addEventListener('input', () => setTimeout(updatePreview, 50));
            telefoneInput.addEventListener('input', () => {
                telefoneInput.value = maskPhone(telefoneInput.value);
                saveData();
            });
            precoInput.addEventListener('input', (e) => {
                e.target.value = formatPriceInput(e.target.value);
            });
             kmInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/\D/g, '');
            });


            // --- Funções de Formatação ---
            function maskPhone(value) {
                value = value.replace(/\D/g, '');
                value = value.replace(/^(\d{2})(\d)/, '($1) $2'); // Adiciona espaço
                value = value.replace(/(\d{4,5})(\d{4})$/, '$1-$2'); // Hífen
                return value;
            }
            
            function formatPriceInput(value) {
                return value.replace(/\D/g, '');
            }

            function formatPriceDisplay(price) {
                const number = parseFloat(price);
                if (isNaN(number)) return "";
                return number.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            function formatKmDisplay(km) {
                const number = parseInt(km, 10);
                if (isNaN(number)) return "";
                return `${number.toLocaleString('pt-BR')} KM`;
            }

            function handleImageUpload(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            uploadedImage = img;
                            previewArea.innerHTML = '';
                            previewArea.appendChild(canvas);
                            setTimeout(updatePreview, 100);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            async function updatePreview() {
                if (!uploadedImage) return;

                const data = {
                    marca: document.getElementById('marca').value.trim(),
                    modelo: document.getElementById('modelo').value.trim(),
                    ano: document.getElementById('ano').value.trim(),
                    km: document.getElementById('km').value.trim(),
                    preco: document.getElementById('preco').value.trim(),
                    cilindrada: document.getElementById('cilindrada').value.trim(),
                    cambio: document.getElementById('cambio').checked ? 'Automático' : 'Manual',
                    telefone: document.getElementById('telefone').value.trim(),
                    endereco: fixedAddress,
                };
                
                const headerHeight = uploadedImage.height * 0.15;
                const footerHeight = uploadedImage.height * 0.18;

                canvas.width = uploadedImage.width;
                canvas.height = uploadedImage.height + headerHeight + footerHeight;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.drawImage(uploadedImage, 0, headerHeight, uploadedImage.width, uploadedImage.height);

                drawOverlays(canvas.width, uploadedImage.height, headerHeight, footerHeight, data);

                downloadLink.href = canvas.toDataURL('image/jpeg', 0.95);
                downloadLink.classList.remove('hidden');
            }
            
            function drawOverlays(width, imgHeight, headerHeight, footerHeight, data) {
                const padding = width * 0.03;
                
                // --- Desenha Header ---
                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                ctx.fillRect(0, 0, width, headerHeight);

                ctx.fillStyle = adColor;
                ctx.beginPath();
                ctx.moveTo(width * 0.6, 0);
                ctx.lineTo(width, 0);
                ctx.lineTo(width, headerHeight);
                ctx.lineTo(width * 0.65, headerHeight);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = 'white';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                
                const marcaY = headerHeight * 0.3;
                ctx.font = `900 ${headerHeight * 0.3}px 'Inter'`;
                ctx.fillText(data.marca.toUpperCase(), padding, marcaY);
                
                const modeloY = headerHeight * 0.65;
                ctx.font = `700 ${headerHeight * 0.23}px 'Inter'`;
                ctx.fillText(data.modelo.toUpperCase(), padding, modeloY);
                
                const modeloMetrics = ctx.measureText(data.modelo.toUpperCase());
                const anoX = padding + modeloMetrics.width + width * 0.02;
                
                ctx.font = `700 ${headerHeight * 0.18}px 'Inter'`;
                const anoMetrics = ctx.measureText(data.ano);
                
                ctx.fillStyle = adColor;
                ctx.fillRect(anoX - 5, modeloY - (headerHeight * 0.18)/2 - 5, anoMetrics.width + 10, headerHeight * 0.22 + 5);
                
                ctx.fillStyle = 'white';
                ctx.fillText(data.ano, anoX, modeloY);

                ctx.textAlign = 'right';
                ctx.font = `900 ${headerHeight * 0.4}px 'Inter'`;
                ctx.fillText(formatPriceDisplay(data.preco), width - padding, headerHeight / 2);

                // --- Desenha Footer ---
                const footerStartY = imgHeight + headerHeight;
                const infoBarHeight = footerHeight * 0.4;
                const contactBarStartY = footerStartY + infoBarHeight;
                const contactBarHeight = footerHeight - infoBarHeight;

                ctx.fillStyle = adColor; 
                ctx.fillRect(0, footerStartY, width, infoBarHeight);
                ctx.fillStyle = 'rgba(10, 10, 10, 0.85)';
                ctx.fillRect(0, contactBarStartY, width, contactBarHeight);
                
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const centralText = `${data.cambio.toUpperCase()} • ${data.cilindrada} • ${formatKmDisplay(data.km)}`;
                const vehicleInfoFont = `700 ${infoBarHeight * 0.5}px 'Inter'`;
                ctx.font = vehicleInfoFont;
                ctx.fillText(centralText, width / 2, footerStartY + infoBarHeight / 2);

                const contactY = contactBarStartY + contactBarHeight / 2;
                const iconSize = infoBarHeight * 0.5;
                const textIconGap = iconSize * 0.4;
                const itemGap = width * 0.03;

                ctx.font = vehicleInfoFont;
                
                const items = [
                    { icon: phoneIcon, text: data.telefone },
                    { icon: mapsIcon, text: data.endereco }
                ];

                let totalContactWidth = 0;
                const itemWidths = items.map(item => {
                    const textMetrics = ctx.measureText(item.text.toUpperCase());
                    const width = iconSize + textIconGap + textMetrics.width;
                    totalContactWidth += width;
                    return width;
                });
                totalContactWidth += itemGap * (items.length - 1);

                let logoW = 0;
                if (fixedLogo.complete && fixedLogo.naturalWidth !== 0) {
                    const logoMaxHeight = footerHeight * 1.1; 
                    const logoMaxWidth = width * 0.4;
                    const scale = Math.min(logoMaxWidth / fixedLogo.width, logoMaxHeight / fixedLogo.height);
                    logoW = fixedLogo.width * scale;
                }

                const contactAreaStart = (padding + logoW) + itemGap;
                const contactAreaWidth = width - contactAreaStart - padding;
                let currentX = contactAreaStart + (contactAreaWidth - totalContactWidth) / 2;
                
                ctx.textAlign = 'left';

                items.forEach((item, index) => {
                    if (item.icon.complete && item.icon.naturalWidth !== 0) {
                        ctx.drawImage(item.icon, currentX, contactY - iconSize / 2, iconSize, iconSize);
                    }
                    ctx.fillText(item.text.toUpperCase(), currentX + iconSize + textIconGap, contactY);
                    currentX += itemWidths[index] + itemGap;
                });

                if (fixedLogo.complete && fixedLogo.naturalWidth !== 0) {
                    const logoH = fixedLogo.height * (logoW / fixedLogo.width);
                    const logoY = footerStartY - (logoH - footerHeight) / 2;
                    ctx.drawImage(fixedLogo, padding, logoY, logoW, logoH);
                }
            }
        });
    </script>
</body>
</html>

